on: 
  push:

jobs:
  build:
    name: macOS Build
    runs-on: macOS-latest
    steps:
      - name: Force xcode 11
        run: sudo xcode-select -switch /Applications/Xcode_11.1.app  

      - uses: actions/checkout@v1

      - name: Prepare certificates and keys
        env:
          CERT_PASSWORD: ${{ secrets.CERT_PASSWORD }}
        run: |
          cd certificates
          ./load-certificates.sh

      - name: Dependencies
        run: |
          cd VelocitekControlCenter
          carthage bootstrap --no-use-binaries --platform mac --cache-builds

      - name: Build
        run: xcodebuild -project "VelocitekControlCenter/Velocitek Control Center.xcodeproj" -target "Velocitek Control Center" -configuration Release

      - name: Package DMG
        run: |
          cd dmg-maker-bash
          ./create-and-sign-dmg.sh

